<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
    <style>
        *{
            font-family: 'Open Sans', sans-serif;
            color: white;
            background-color: transparent;
        }
        body{
            height: 100vh;
            background-color: #41436a;
            color: white;
        }
        textarea{
            width: 1500px;
            height: 700px;
            display: none;
        }
        .contentdiv{
            border-bottom: 2px solid black;
            display: grid;
            grid-template-columns: 5fr 1fr 1fr; 
        }
        .flex{
            display: flex;
            justify-content: center;
        }
        button ,a{
                padding: 5px 80px;
            border-radius: 20px;
            background-color:transparent;
            border: 2px solid white;
            color: white;
            outline: 5px solid rebeccapurple;
        }
        .heading{
            text-align: center;
            font-family: 'Lobster', cursive;
            font-size: 40px;
        }
        #btnupload{
            margin-top: 10px;
        }
        img{
            height: 100%;
            width: 36%;
            margin-top: 300px;
        }
        .makeflexthencenter{
            display: flex;
            justify-content: center;
        }
        .hideme{
            display: none;
        }
        .textcenter{
            text-align: center;
        }
        #calbut,#result{
            display: none;
        }
        @media (max-width:2000px){
            .maindiv{
                margin: 10px 200px;
                display: flex;
                justify-content: center;
            }
        }
        @media (max-width:800px){
            .maindiv{
                margin: 5px 5px;
            }
        }
        .addmargintop{
            margin-top: 40px;
        }
        .hideme2{
            visibility: hidden;
        }
        .spacebottom{
            margin-bottom: 100px;
        }
        .widthchange{
            width: 20px;
        }
        @media (max-width:420px) {
            .realgrade{
                width: 20px;
            }
        }
    </style>
</head>
<body>
    <div >
        <div  class="maindiv">
            <div>
    <h1 class="heading">WhatIfResultChanges</h1>
    <p id="pdfnotselecttext" class="hideme"> Pdf Not Selected (or) Wrong PDF Selected  .......Please Refresh The Page And Select Pdf</p>
    <p class="hideme2">Lorem ipsum dolor</p>
    <h1>Smart Way To Avoid Boring Calculations</h1>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. At maiores a nesciunt odio. Minus ea quidem labore quod nemo. Praesentium?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. At maiores a nesciunt odio. Minus ea quidem labore quod nemo. Praesentium?</p>
    <p class="hideme2">Lorem ipsum dolor</p>
    <a href="#btnupload">Get Started</a>

    <label>


        <div class="makeflexthencenter">
            <img src="http://www.pngall.com/wp-content/uploads/2/Upload-PNG.png" alt="" id="upimg">

        </div>
        <div class="makeflexthencenter">
            <input type="file" id="inputfile" class="hideme" id="selectpdf"/>

        </div>

    </label>


    <br/>
    <div class="makeflexthencenter">
        <div>
            <button type="button" id="btnupload">upload</button>
            <p class="textcenter" id="text">click on upload after <br/> u select an pdf</p>
            <p id="loading" class="hideme textcenter">loading....</p>

        </div>
    </div>
    <br>
    <br>
    <textarea name="" id="resulttext" cols="30" rows="10"></textarea>
    <div id="add">

    </div>
    <div class="flex">
        <div>
            <h1 id="result" class="textcenter">Result</h1>
            <button onclick="resultcal()" id="calbut" class="spacebottom">Calculate Result</button>

        </div>

        </div>
    </div>
</div>
</div>
    <script>
        const btnupload=document.getElementById("btnupload");
        const inputfile=document.getElementById("inputfile");
        const resulttext=document.getElementById("resulttext");


        btnupload.addEventListener('click',()=>{
            document.getElementById("loading").style.display="block";
            const formdata=new FormData();


            formdata.append("pdfFile",inputfile.files[0])



            fetch("/gettext",{
                method:"post",
                body:formdata
            }).then((response)=>{
                return response.text();
            }).then((extractedtext)=>{
                resulttext.value=extractedtext
                console.log(extractedtext)
                cal();
                })
        })
        let word;
        let impdata;
        let start;
        let end;
        let newdata1="";
        let newdata2="";
        let finaldata="";
        let finaldata1="";
        let wordarray=[];
        let wordarray2=[];
        let finalarray=[];
        let creditsarray=[];
        function cal(){
            document.getElementById("calbut").style.display="block";
            document.getElementById("result").style.display="block";
            document.getElementById("upimg").style.display="none";
            document.getElementById("text").style.display="none";
            document.getElementById("btnupload").style.display="none";
            try{
                document.getElementById("selectpdf").style.display="none";

            }
            catch(e){

            }

        let data=resulttext.value
            
            newdata=data.toLowerCase()
            // console.log(newdata)
            for(var i=0;i<data.length;i++){
                if(data[i]==newdata[i]){
                    newdata1=newdata1+data[i];
                }
            }
            // console.log(newdata1);
            newdata2=newdata1.toLocaleUpperCase();
            // console.log(newdata2);
            for(var i=0;i<newdata1.length;i++){
                if(newdata1[i]==newdata2[i]){
                    finaldata=finaldata+newdata1[i];
                }
            }
            console.log(finaldata)
        
            for(var i=0;i<finaldata.length;i++){
                if(finaldata[i]=="-" || finaldata[i]==":" || finaldata[i]=="," || finaldata[i]=="=" || finaldata1=="/" ){
                    finaldata1=finaldata1+" "
                }
                else{
                    finaldata1=finaldata1+finaldata[i]
                }
            }
            console.log(finaldata1)
            for (let index = 0; index < finaldata1.length; index++) {
                console.log(finaldata1[index]);
                
            }
            word="";
            for(var i=0;i<data.length;i++){
                if(data[i]==" "){
                    wordarray.push(word);
                    var checkword=word+"\n";
                    if(checkword=="Sec"){
                        console.log("true");
                    }
                    else{
                        console.log("false")
                    }
                    word="";
                }
                else{
                    word=word+data[i];
                }
            }
            console.log(wordarray)
            let startnew=data.indexOf("Secured\n")+8;
            let endnew=data.lastIndexOf("Result")+5;
            console.log(startnew)
            console.log(endnew)
            word="";
            for(var i=startnew;i<endnew;i++){
                console.log(data[i]);
                if(data[i]=="\n"){
                    finalarray.push(word);
                    console.log("new line startdred")
                    word="";
                }
                word=word+data[i];
            }
            console.log(finalarray)
            if(finalarray.length==0){
                document.getElementById("pdfnotselecttext").style.display="block";
            }
            let cfa=[];
            word="";
            finalarray.forEach((val)=>{
                word="";
                len=val.length
                for(var i=6;i>0;i--){
                        word=word+val[len-i];
                }
                cfa.push(word);
            })
            console.log(cfa)
            cfa.pop();
            console.log(cfa)
            
            cfa.forEach((val)=>{
                console.log()
                creditsarray.push(parseInt(val[0]+val[1]));
            })
            console.log(creditsarray);
            
            for(var i=0;i<creditsarray.length;i++){
                if(creditsarray[i]==5){
                    creditsarray[i]=1.5;
                }
            }
            console.log(creditsarray);
            let gradearray=[];
            cfa.forEach((val)=>{
                console.log(val[val.length-1])
                
                if(val[val.length-1]=='S'){
                    console.log("true");
                    gradearray.push(10);
                }
                else if(val[val.length-1]=='A'){
                    console.log("true");
                    gradearray.push(9);
                }
                else if(val[val.length-1]=='B'){
                    console.log("true");
                    gradearray.push(8);
                }
                else if(val[val.length-1]=='C'){
                    console.log("true");
                    gradearray.push(7);
                }
                else if(val[val.length-1]=='D'){
                    console.log("true");
                    gradearray.push(6);
                }
                else if(val[val.length-1]=='E'){
                    console.log("true");
                    gradearray.push(5);
                }
                else{
                    gradearray.push(0);
                }
            })
            console.log(gradearray)
            console.log(creditsarray)
            creditsarray.forEach((val,index)=>{
                if(val){

                }
                else{
                    creditsarray[index]=0;
                }
            })
            console.log(creditsarray)
            console.log(cfa)
            console.log()
            let namearray=[];
            // calculating namearrays
            finalarray.forEach((val,index)=>{
                word="";
                console.log(val);
                var len=val.length
                var i1;
                if(index==0){
                    i1=5;
                }
                else{
                    i1=6;
                }
                for(var i=i1;i<len-6;i++){
                    console.log(val[i]);
                    word=word+val[i];
                }
                namearray.push(word);
            })
            console.log(namearray);
            namearray.pop();



            namearray.forEach((val,index)=>{
                var con=document.getElementById("add");
                var divv=document.createElement("div");
                divv.setAttribute("class","contentdiv")
                var name=document.createElement("p");
                var text=val;
                name.append(text);
                divv.append(name);
                var c=document.createElement("input")
                c.setAttribute("id",`grade${index}`)
                c.setAttribute("class","widthchange")
                c.value=creditsarray[index];
                divv.append(c)
                con.append(divv)
                var inputfield=document.createElement("input")
                inputfield.setAttribute("id",`inp${index}`);
                inputfield.value=gradearray[index];
                inputfield.setAttribute("class","realgrade")
                divv.append(inputfield)


        
            })
            document.getElementById("loading").style.display="none";
        }
        function resultcal(){
            console.log("calling");
            console.log(creditsarray);
            var res=0;
            creditsarray.forEach((val,index)=>{
                res=res+parseFloat(document.getElementById(`grade${index}`).value)*document.getElementById(`inp${index}`).value;
            })
            console.log(res);
            var total=0;
            creditsarray.forEach((val,index)=>{
                total=total+parseFloat(document.getElementById(`grade${index}`).value)
            })
            console.log("total",total);
            console.log(res/total);
            let profinal=res/total;
            profinal=parseFloat(profinal.toFixed(2));
            document.getElementById("result").innerHTML=profinal;
        }
        function handleclick(){
            console.log("calling");
            document.getElementById("btnupload").click();
        }
    </script>
</body>
</html>